{
   "AWSTemplateFormatVersion": "2010-09-09",

   "Parameters" : {

    "STACKNAME": {
      "Description" : "Name of an existing EC2 KeyPair to enable SSH access to the instance",
      "Type": "String",
    }

   },

   "Resources": {

      "EC2Role": {
         "Type": "AWS::IAM::Role",
         "Properties": {
            "AssumeRolePolicyDocument": {
               "Version" : "2012-10-17",
               "Statement": [ {
                  "Effect": "Allow",
                  "Principal": {
                     "Service": [ "ec2.amazonaws.com" ]
                  },
                  "Action": "sts:AssumeRole"
               } ]
            },
            "Path": "/",
            "RoleName": "ec2Role"
         }
      },


      "EC2RolePolicies": {
         "Type": "AWS::IAM::Policy",
         "Properties": {
            "PolicyName": "ec2policy",
            "PolicyDocument": {
               "Version" : "2012-10-17",
               "Statement": [ {
                  "Effect": "Allow",
                  "Action": "*",
                  "Resource":  "*"
               } ]
            },
            "Roles": [ {
               "Ref": "EC2Role"
            } ]
         }
      },

      "EC2Profile": {
         "Type": "AWS::IAM::InstanceProfile",
         "Properties": {
            "Path": "/",
            "Roles": [ { "Ref": "EC2Role" } ]
         }
      },

      "SampleBucketPolicy" : {
        "Type" : "AWS::S3::BucketPolicy",
        "Properties" : {
          "Bucket" : "s3.csye6225-spring2018-zenan.me",
          "PolicyDocument": {
            "Statement":[{
             "Action":"*",
             "Effect":"Allow",
             "Resource": { "Fn::Join" : ["", ["arn:aws:s3:::", { "Ref" : "myExampleBucket" } , "/*" ]]},
             "Principal":"*",
              "Condition":{
                "StringLike":{
                  "aws:Referer":[
                    "http://www.example.com/*",
                    "http://example.com/*"
                  ]
                }
              }
            }]
          }
        }
      }
      
   }
}